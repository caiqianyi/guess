<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.caiqianyi.guess.core.dao.IGuessTopicMapper">
    
	<sql id="Base_Where_Clause" >
	    <trim prefix="where" prefixOverrides="and|or" >
	      <if test="topic.topicId != null" >
	         and topicId = #{topic.topicId}
	      </if>
	      <if test="topic.roomId != null" >
	         and roomId = #{topic.roomId}
	      </if>
	      <if test="topic.label != null" >
	         and label = #{topic.label}
	      </if>
	      <if test="topic.kind != null" >
	         and kind = #{topic.kind}
	      </if>
	      <if test="topic.league != null" >
	         and league = #{topic.league}
	      </if>
	      <if test="topic.groupId != null" >
	         and groupId = #{topic.groupId}
	      </if>
	      <if test="topic.topicType != null" >
	         and topicType = #{topic.topicType}
	      </if>
	      <if test="topic.orderBy != null" >
	         and orderBy = #{topic.orderBy}
	      </if>
	      <if test="topic.status != null" >
	         and status = #{topic.status}
	      </if>
	      <if test="topic.optionId != null" >
	         and optionId = #{topic.optionId}
	      </if>
	    </trim>
	</sql>
	
	<sql id="Base_Column_List" >
	    id, topicId, roomId, subject, label, kind, league, groupId,topicType,orderBy, joinCount, status, 
	    optionId, createTime, beginTime, overTime, finishTime
	</sql>
	
	<select id="findOneGuessTopicBy" resultType="com.caiqianyi.guess.entity.GuessTopic">
	    select <include refid="Base_Column_List" />
	    from guess_topic <include refid="Base_Where_Clause" />
	</select>
	
	<select id="findGuessTopicByForPager" resultType="com.caiqianyi.guess.entity.GuessTopic">
	    select <include refid="Base_Column_List" />
	    from guess_topic <include refid="Base_Where_Clause" />
		<if test="start != null and start !=''">
		    and DATE_FORMAT(beginTime,'%Y-%m-%d')<![CDATA[>=]]>#{start,jdbcType=VARCHAR}
		</if>
		<if test="end != null and end !=''">
		    and DATE_FORMAT(beginTime,'%Y-%m-%d')<![CDATA[<=]]>#{end,jdbcType=VARCHAR}	
		</if>
	</select>
	
	<select id="findAllGuessTopicBy" resultType="com.caiqianyi.guess.entity.GuessTopic">
	    select <include refid="Base_Column_List" />
	    from guess_topic <include refid="Base_Where_Clause" />
		<if test="start != null and start !=''">
		    and DATE_FORMAT(beginTime,'%Y-%m-%d')<![CDATA[>=]]>#{start,jdbcType=VARCHAR}
		</if>
		<if test="end != null and end !=''">
		    and DATE_FORMAT(beginTime,'%Y-%m-%d')<![CDATA[<=]]>#{end,jdbcType=VARCHAR}	
		</if>
	</select>
	
	<insert id="insert" parameterType="com.caiqianyi.guess.entity.GuessTopic">
	    insert into guess_topic (<include refid="Base_Column_List" />)
	    	values (UUID(), #{topicId}, #{roomId}, #{subject}, #{label}, #{kind}, #{league}, #{groupId}, #{topicType} 
	    			#{orderBy}, #{joinCount}, #{status}, #{optionId}, now(), #{beginTime}, #{overTime}, #{finishTime})
	</insert>
	
	<update id="update" parameterType="com.caiqianyi.guess.entity.GuessTopic">
	    update guess_topic
	    <set>
	      <if test="subject != null" >
	        subject = #{subject},
	      </if>
	      <if test="label != null" >
	        label = #{label},
	      </if>
	      <if test="kind != null" >
	        kind = #{kind},
	      </if>
	      <if test="league != null" >
	        league = #{league},
	      </if>
	      <if test="groupId != null" >
	        groupId = #{groupId},
	      </if>
	      <if test="joinCount != null" >
	        joinCount = #{joinCount},
	      </if>
	      <if test="status != null" >
	        status = #{status},
	      </if>
	      <if test="optionId != null" >
	        optionId = #{optionId},
	      </if>
	      <if test="finishTime != null" >
	        finishTime = #{finishTime},
	      </if>
	    </set>
	    where id = #{id}
	</update>
	
	<delete id="delete">
	    delete from guess_topic where id = #{id}
	</delete>
	
	<sql id="Guess_Topic_Option_Column_List" >
	    id, topicId, name, value, orderBy, buyCount, buyAmount, isSelected, odds, createTime
	</sql>
	<sql id="Guess_Topic_Option_Show_Column_List" >
	    id, topicId, name, value, orderBy, isSelected, odds, createTime
	</sql>
	
	<sql id="Option_Base_Where_Clause" >
	    <trim prefix="where" prefixOverrides="and|or" >
	      <if test="topic.topicId != null" >
	         and topicId = #{topic.topicId}
	      </if>
	      <if test="topic.id != null" >
	         and topicId = #{topic.id}
	      </if>
	    </trim>
	</sql>
	
	<select id="findOneGuessTopicOptionBy" resultType="com.caiqianyi.guess.entity.GuessTopicOption">
	    select <include refid="Guess_Topic_Option_Column_List" />
	    from guess_topic_option <include refid="Option_Base_Where_Clause" />
	</select>
	
	<select id="findAllGuessTopicOptionBy" resultType="com.caiqianyi.guess.entity.GuessTopicOption">
	    select <include refid="Guess_Topic_Option_Show_Column_List" />
	    from guess_topic_option <include refid="Option_Base_Where_Clause" />
	</select>
	
	<insert id="insertOption">
	    insert into guess_topic_option (<include refid="Guess_Topic_Option_Column_List" />)
	    	values (UUID(),#{topicId}, #{name}, #{value}, #{orderBy}, 0, '0.00', 0, #{odds}, now())
	</insert>
	
	<update id="updateOption">
	    update guess_topic_option
	    <set>
	      <if test="name != null" >
	        name = #{name},
	      </if>
	      <if test="value != null" >
	        value = #{value},
	      </if>
	      <if test="orderBy != null" >
	        orderBy = #{orderBy},
	      </if>
	      <if test="buyCount != null" >
	        buyCount = #{buyCount},
	      </if>
	      <if test="buyAmount != null" >
	        buyAmount = #{buyAmount},
	      </if>
	      <if test="isSelected != null" >
	        isSelected = #{isSelected},
	      </if>
	      <if test="odds != null" >
	        odds = #{odds}
	      </if>
	    </set>
	    where id = #{id}
	</update>
	
	<delete id="deleteOption">
	    delete from guess_topic_option where id = #{id}
	</delete>
	
	<delete id="deleteOptionByTopicId">
	    delete from guess_topic_option where topicId = #{topicId}
	</delete>
</mapper>
